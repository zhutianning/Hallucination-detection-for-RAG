# 高复杂度问题集 - test_advanced_250.json

## 📊 概述
本问题集针对25份年报（2022-2024年度）生成了250条高质量、无重复的财务分析问题，专门用于构建RAG系统和幻觉检测器。

## ✅ 统计信息
- **总问题数**: 250条
- **唯一问题数**: 250条（100%独特，0重复）
- **覆盖年报**: 25份（中国人保、四方股份、中国神华、中信证券、中材国际、工商银行、中国中免、建设银行、中国银行、中金公司、中国黄金、寒武纪等）
- **覆盖年度**: 2022-2024年度

## 🎯 问题类型分布（严格均衡）

| 类型 | 数量 | 占比 | 说明 |
|------|------|------|------|
| **事实提取类** | 50题 | 20% | 直接查询具体数值、名称、日期 |
| **列举枚举类** | 50题 | 20% | 列出多个项目/明细 |
| **比较计算类** | 50题 | 20% | 同比/环比/比率/趋势计算 |
| **判断验证类** | 50题 | 20% | 是否披露/是否存在 |
| **推理分析类** | 50题 | 20% | 归因/评估/解释 |

## 📝 各类型问题示例

### 1. 事实提取类（20%）
直接查询单个具体数值、名称或日期，测试精确检索能力。

**示例：**
- 中国人保2022年度的营业收入总额是多少亿元？
- 四方股份2023年度归属于母公司股东的净利润是多少亿元？
- 中国神华2024年度末总资产规模达到多少亿元？
- 工商银行2023年度的基本每股收益（EPS）是多少元？
- 建设银行2024年度的加权平均净资产收益率（ROE）是多少？

**难度特点：**
- 需要从年报中准确定位单个数值
- 考察数值提取的精确性与单位识别
- 适合检测数值编造类幻觉

### 2. 列举枚举类（20%）
要求列出多个相关项目或明细，测试结构化信息提取能力。

**示例：**
- 请列举中国人保2022年度前五大客户的名称及其销售收入占比。
- 请列举中信证券2023年度前五大供应商的名称及其采购金额占比。
- 中国中免2024年度主要业务板块有哪些？各板块收入占比分别是多少？
- 请列举工商银行2023年度主要子公司的名称、持股比例及其对合并报表净利润的贡献。
- 寒武纪2023年度前十大股东分别是谁？持股比例各是多少？

**难度特点：**
- 需要从多个位置或表格中提取列表信息
- 考察结构化数据的完整性与准确性
- 适合检测遗漏信息与编造名单的幻觉

### 3. 比较计算类（20%）
要求进行同比、环比或跨期比较计算，测试多期数据对比能力。

**示例：**
- 计算中国人保2022年度营业收入同比增长率和增长金额。
- 计算四方股份2023年度净利润同比增长率和增长金额。
- 计算中国神华2024年度与上一年度毛利率的变化幅度（百分点）。
- 计算中信证券2023年度与上一年度ROE的变化幅度（百分点）。
- 比较工商银行2024年度Q1至Q4各季度营业收入，确定最高季度及其占比。

**难度特点：**
- 需要提取多期数据并进行计算
- 考察数值计算的准确性与逻辑正确性
- 适合检测计算错误与逻辑混乱的幻觉

### 4. 判断验证类（20%）
判断特定事项是否发生或披露，并补充相关细节。

**示例：**
- 中国人保2022年度是否实施现金分红？如实施，分红金额和分红率各是多少？
- 四方股份2023年度是否存在商誉减值？如存在，减值金额是多少？
- 中国神华2024年度是否完成重大并购或资产重组？如完成，交易标的和对价各是什么？
- 中信证券2023年度是否实施股权激励计划？如实施，激励对象数量和授予股数各是多少？
- 工商银行2024年度审计意见类型是什么？是否存在关键审计事项或强调事项段？

**难度特点：**
- 需要先判断是否披露，再提取细节
- 考察条件分支逻辑与信息完整性
- 适合检测虚构事件与细节编造的幻觉

### 5. 推理分析类（20%）
要求进行归因、评估或解释，测试深度理解与推理能力。

**示例：**
- 归因分析：中国人保2022年度营业收入增长的主要驱动因素（价格vs数量）。
- 原因解释：四方股份2023年度毛利率变化是成本驱动还是结构优化？
- 差异分析：中国神华2024年度净利润与经营现金流净额差异的会计调整项。
- 风险评估：中信证券2023年度应收账款增长是否存在信用风险或激进确认？
- ROE拆解：工商银行2024年度ROE变化的杜邦三因素贡献度分析。

**难度特点：**
- 需要跨章节整合信息并进行逻辑推理
- 考察因果关系识别与深度分析能力
- 适合检测逻辑错误、归因混乱与过度推断的幻觉

## 🎨 问题设计特点

### 高复杂度要求
- **多维度分析**: 同时涉及多个财务指标或报表科目
- **交叉引用**: 结合利润表、资产负债表、现金流量表
- **精确计量**: 要求具体数值、百分点、金额等量化结果
- **条件约束**: 包含"如存在"、"请区分"、"分别"等限定词

### 幻觉检测友好
- ✅ **事实可验证**: 所有问题答案均可在年报中找到依据
- ✅ **数值明确**: 要求具体数值与单位，易于检测编造
- ✅ **条件判断**: "是否"类问题需要先判断再回答，测试逻辑
- ✅ **完整性要求**: 列举类问题要求完整列表，测试遗漏
- ✅ **计算验证**: 比较类问题可通过数学验算检查正确性

### 避免模糊性
- 每个问题聚焦单一明确的查询或分析任务
- 避免开放式泛泛而谈
- 设置明确的数量/范围/时间约束

## 📚 使用场景

### 1. RAG系统评测
- **召回能力**: 测试能否准确定位相关章节/表格/页面
- **多跳推理**: 部分问题需要跨页面整合信息
- **表格理解**: 列举类问题需要准确解析财务报表
- **数值提取**: 事实提取类测试精确的数值识别能力

### 2. 幻觉检测器训练
#### 正样本构造
- 使用RAG检索+LLM生成标准答案
- 人工校验关键数值与逻辑

#### 负样本构造（6类幻觉）
| 幻觉类型 | 构造方法 | 适用问题类型 |
|----------|----------|--------------|
| **数值编造** | 修改具体数值或单位 | 事实提取、比较计算 |
| **信息遗漏** | 列表不完整或缺失关键项 | 列举枚举 |
| **虚构事件** | 编造未披露的并购/诉讼等 | 判断验证 |
| **逻辑错误** | 颠倒因果或归因错误 | 推理分析 |
| **时间混淆** | 混用不同年度的数据 | 比较计算 |
| **计算错误** | 增长率/比率计算错误 | 比较计算 |

#### 幻觉检测指标
- **事实一致性**: 答案中数值/名称是否与原文一致
- **逻辑连贯性**: 因果关系是否合理
- **完整性**: 列举类答案是否遗漏关键项
- **计算准确性**: 数学计算是否正确

### 3. 质量控制检查点
评估生成答案时的检查清单：
- [ ] 所有数值是否有报告支撑？（附页码）
- [ ] 列举类答案是否完整无遗漏？
- [ ] 计算类答案的公式与结果是否正确？
- [ ] 判断类答案是否先回答"是否"再补充细节？
- [ ] 推理类答案的归因逻辑是否有依据？
- [ ] 是否明确标注来源文件名与页码？

## 📂 文件格式说明

### JSON结构
```json
[
  {
    "filename": "2023-03-25-601319.SH-中国人保-601319中国人保2022年年度报告.pdf",
    "page": 127,
    "question": "中国人保2022年度的营业收入总额是多少亿元？",
    "answer": "",
    "type": "事实提取"
  },
  ...
]
```

### 字段说明
- `filename`: 年报PDF文件名（完整文件名）
- `page`: 建议检索的页码（基于关键词启发式匹配）
- `question`: 问题文本
- `answer`: 答案字段（预留为空，供RAG系统填充）
- `type`: 问题类型（事实提取/列举枚举/比较计算/判断验证/推理分析）

## 🔧 生成与验证脚本

### 生成脚本
```bash
python tools/generate_advanced_questions.py
```

### 验证脚本
```bash
python tools/analyze_question_types.py
```

输出示例：
```
============================================================
问题类型分布统计
============================================================

总问题数: 250
唯一问题数: 250
重复问题数: 0

各类型问题数量：
  事实提取: 50题 (20.0%)
  列举枚举: 50题 (20.0%)
  判断验证: 50题 (20.0%)
  推理分析: 50题 (20.0%)
  比较计算: 50题 (20.0%)
```

## 📈 与原始test.json的对比

| 维度 | test.json | test_advanced_250.json |
|------|-----------|------------------------|
| 问题总数 | 4838条 | 250条 |
| 唯一性 | 存在大量重复 | 100%独特 |
| 类型分布 | 不均衡（推理类偏多） | 严格均衡（5类×50题） |
| 复杂度 | 简单-中等 | 中等-高 |
| 幻觉检测友好度 | 中等 | 高（带类型标签） |
| 覆盖范围 | 行业研报 | 上市公司年报 |

## 🚀 后续优化方向

### 可选增强（按需）
1. **跨年度对比**：增加"对比公司2023与2024年度ROE变化"等题
2. **跨公司对比**：增加"对比工商银行与建设银行2024年不良率"等题
3. **多跳推理**：增加"先找到最大收入板块，再分析其增长驱动"等题
4. **图表理解**：增加"根据年报第X页图表，分析趋势"等题
5. **注释依据**：为每题标注建议检索页码范围或章节

## 📝 版本历史
- **v2.1** (2025-11-05): 新增空白 `answer` 字段，供RAG系统填充答案
- **v2.0** (2025-11-05): 重构为5类均衡分布，每类严格50题
- **v1.0** (2025-11-05): 初始版本（已废弃，类型分布不均）

## 🔄 使用流程建议

### 第一步：使用RAG系统生成答案
```python
# 伪代码示例
import json
rag = SimpleRAG("all_pdf_page_chunks_merged.json")
rag.setup()

with open("datas/test_advanced_250.json", 'r', encoding='utf-8') as f:
    test_data = json.load(f)

for item in test_data:
    result = rag.generate_answer(item['question'], top_k=5)
    item['answer'] = result['answer']
    item['source_page'] = result.get('page', '')
    item['source_filename'] = result.get('filename', '')

# 保存带答案的结果
with open("outputs/test_advanced_250_with_answers.json", 'w', encoding='utf-8') as f:
    json.dump(test_data, f, ensure_ascii=False, indent=2)
```

### 第二步：人工校验与幻觉标注
对生成的答案进行质量评估：
1. 抽样检查事实提取类答案的数值准确性
2. 验证列举枚举类答案的完整性
3. 核验比较计算类答案的计算正确性
4. 检查判断验证类答案的逻辑一致性
5. 评估推理分析类答案的归因合理性

### 第三步：构建幻觉检测训练集
基于标注结果，构造正负样本对：
- **正样本**: 通过人工验证的高质量答案
- **负样本**: 标注了幻觉类型的错误答案

## 📌 注意事项

1. **页码字段仅供参考**: `page` 字段是基于关键词启发式匹配的建议页码，实际答案可能在其他页面
2. **答案字段为空**: 需要通过RAG系统或人工填充
3. **类型字段用途**: 用于区分问题难度和评估不同能力维度
4. **文件名完整性**: 包含完整路径信息，便于定位源文件
